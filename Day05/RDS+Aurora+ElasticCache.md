# 6. RDS+Aurora+ElasticCache

## RDS

- Relational Database Service
- SQL(Structured Query Language)을 쿼리 언어로 사용하는 데이터베이스 서비스
- RDS에 DB를 생성할 수 있고, AWS가 DB를 관리한다.
- DB 엔진 유형
    - **Postgres, MySQL, MariaDB, Oracle, Microsoft SQL Server**, Aurora(AWS Proprietary database)

### RDS vs Deploying DB on EC2

- RDS는 관리형 서비스
- 데이터베이스를 포함하여 다양한 서비스를 제공한다.
    - 데이터베이스 프로비저닝, 운영체제 패치 자동화
    - 지속적인 백업 생성(특점 시점으로 복원)
    - 모니터링 대시보드
    - 읽기 전용 복제본 → 읽기 성능 개선
    - 재해 복구를 위해 다중 AZ 설정
    - 유지 관리 기간에 업그레이드
    - 인스턴스 유형을 늘려 수직 확장, 읽기 전용 복제본 늘려 수평 확장
    - 파일 스토리지는 EBS(gp2 or io1)에 구성됨
- 단점 : RDS 인스턴스에 **SSH 액세스가 불가능하다.**

### RDS - Storage Auto Scaling

- RDS 데이터베이스를 만들 때, RDS Auto Scaling이 활성화되어 있으면, RDS가 감지해서 자동으로 스토리지를 확장해준다.
- 애플리케이션이 RDS 데이터베이스에서 읽기와 쓰기 작업을 많이 하면 **임계값에 도달**하게 되고 RDS가 자동으로 스토리지를 Auto Scaling한다.
- 이를 위해서는 최대 스토리지 임곗값을 설정해야 한다. = 스토리지를 확장할 최대치를 정해야 한다.
    - 할당된 공간에 남은 공간이 10% 미만이 되면 스토리지를 자동으로 수정한다.
    - 스토리지 부족 상태가 5분 이상 지속되거나 지난 수정으로부터 6시간 지났을 경우, 스토리지가 자동 확장된다.
- **워크로드를 예측할 수 없는 애플리케이션에 유용**하다.
- 모든 RDS 데이터베이스 엔진에서 지원되는 기능이다.

---

## RDS Read Replicas for read scalability

- 읽기 전용 복제본은 읽기를 스케일링한다.
- 애플리케이션은 데이터베이스 인스턴스에 대해 읽기와 쓰기를 수행한다.
- 읽기 전용 복제본을 최대 다섯 개까지 생성할 수 있다.
- 동일한 가용 영역 또는 리전을 걸쳐서 생성될 수 있다.
- 3가지 옵션
    
    ![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/115cc977-be93-4d62-a103-f9d2e07b5ee0/Untitled.png)
    
    - 주된 RDS 데이터베이스 인스턴스와 읽기 전용 RDS 데이터베이스 복제본 사이에서 비동기식 복제가 발생한다.
        
        ( 비동기식 : 읽기가 일관적으로 유지된다. )
        
    - 애플리케이션에서 데이터를 복제하기 전에 읽기 전용 복제본을 읽으면 모든 데이터를  얻을 수 있다.
- 읽기 전용 RDS 복제본을 데이터베이스로 승격시킬 수 있다.
    - 데이터베이스로 승격시키려면 그에 대한 권한을 획득하면 된다.
    - 승격하게 되면 복제 매커니즘을 탈피하게 된다.
    - 자체적인 생명 주기를 갖는다.
- 읽기 전용 복제본을 사용하려는 경우, 애플리케이션에 있는 모든 연결을 업데이트해야 한다.
    - RDS 클러스터 상의 읽기 전용 복제본 전체 목록을 활용할 수 있다.

### RDS Read Replicas - Use Case

- 평균적인 로드를 감당하는 생산 데이터베이스가 있다.
- 이때 새로운 애플리케이션이 해당 데이터베이스를 기반으로 보고와 분석을 실시한다.
- 해당 애플리케이션에 데이터베이스를 연결하면 오버로드가 발생하여 애플리케이션 속도가 느려진다.
- 이때 새로운 워크로드에 대한 읽기 전용 복제본을 생성한다.
- 데이터베이스 인스턴스와 읽기 전용 복제본 간 비동기식 복제가 발생한다.
- 보고 애플리케이션을 통해서 해당 복제본을 사용하면 된다.
- **읽기 전용 복제본은 SELECT 명령문만 사용**한다.

### RDS Read Replicas - Network Cost

- 하나의 가용 영역에서 다른 가용 영역으로 데이터가 이동할 때 비용이 발생한다.
- 예외가 있는데, 보통 이러한 예외는 관리형 서비스에서 나타난다.
- RDS 읽기 전용 복제본은 관리형 서비스!
    - 읽기 전용 복제본이 다른 AZ 상에 있지만, 동일한 리전 내에 있을 때는 비용이 발생하지 않는다.
    - 다른 리전에 복제본이 존재하는 경우, 네트워크에 대한 비용이 발생한다.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/3ec21f66-5529-4898-ad60-ab77218d18d0/Untitled.png)

### RDS Multi AZ

- 다중 AZ는 재해 복구에 사용된다.
- 스탠바이 RDS DB 인스턴스에 마스터 DB의 모든 변화를 동기적으로 복제한다.
- 애플리케이션이 쓰기 작업을 수행하면 스탠바이 RDS DB에도 변경사항이 그대로 복제된다.
- 하나의 DNS 이름을 갖는다.
- 그래서 만약 마스터에 문제가 생길 때면, 스탠바이 RDS에 자동으로 페일오버된다.
- 이를 통해 가용성을 높일 수 있다. (다중 AZ)
- 전체 AZ 또는 네트워크가 손실될 때 대비한 장애 조치이다.
- **스탠바이 DB는 스케일링할 수 없다. → 그 누구도 읽거나 쓸 수 없다. (대기상태)**
- 마스터 데이터베이스에 문제가 발생할 경우를 대비한 장애 조치이다.

- 재해 복구를 위해 읽기 전용 복제본을 다중 AZ로 설정할 수 있다.

### RDS - From Single AZ to Multi AZ

- 다운타임이 전혀 없다.
- 단일 AZ → 다중 AZ를 전환할 때 데이터베이스를 중지할 필요가 없다.
- RDS 수정을 클릭 후 다중 AZ 기능을 활성화하기만 하면 된다. 그러면 알아서 스탠바이 RDS가 생성된다.
- 내부적으로 다음과 같은 일이 발생한다.
    - 기본 데이터베이스의 RDS가 자동으로 스냅샷을 생성한다.
    - 해당 스냅샷은 새로운 스탠바이 데이터베이스에 복원된다.
    - 복원이 완료되면 두 데이터베이스 사이에서 동기화가 설정된다.
    - 다중 AZ 설정 상태가 된다.

---

## RDS Custom

- 두 유형의 데이터베이스 타입이 지원한다.
    - Oracle, Microsoft SQL Server
- OS 및 데이터베이스 사용자 지정 기능에 액세스할 수 있다.
- RDS를 통해 AWS에서의 데이터베이스 자동화 설정, 운영, 스케일링의 장점을 가질 수 있다.
- RDS Custom 옵션을 추가하면, 기저 데이터베이스와 운영체제에 액세스가 가능해진다.
    - 내부 설정 구성, 패치 적용, 네이티브 기능이 활성화된다.
    - SSH, SSM 세션 관리자를 사용해서 RDS 뒤에 있는 기저 EC2 인스턴스에 액세스할 수 있다.
- RDS가 수시로 자동화, 유지 관리, 스케일링과 같은 작업을 수행하지 않도록 자동화를 꺼두는 것이 좋다.
- 기저 EC2 인스턴스에 액세스가 가능하므로 문제가 생길 것을 방지해 DB 스냅샷을 만들어 두는 것이 좋다.

### RDS vs RDS Custom

- RDS는 데이터베이스 전체를 관리한다.
- RDS Custom은 Oracle 및 Microsoft SQL Server에서만 사용 가능하다. (기저 운영체제 및 DB의 관리자 액세스가 가능)

---

## Amazon Aurora

- AWS 고유 기술이다. (오픈소스 X)
- Postgres 및 MySQL과 호환된다.
    - Aurora 데이터베이스에 호환 가능한 드라이버가 있는데 Postgres 및 MySQL 데이터베이스에 연결하면 작동함을 의미한다.
- 클라우드에 최적화되어 있다. RDS의 MySQL보다 5배 높은 성능, Postgres보다 3배 높은 성능을 가지고 있다.
- Aurora 스토리지는 자동으로 확장하는데 10GB에서 시작하고, 더 많은 데이터를 넣을수록 자동으로 128TB까지 커진다.
- 읽기 전용 복제본은 최대 15개까지 둘 수 있다. 복제 속도도 훨씬 빠르다.
- Aurora의 장애 조치는 즉각적이다. 클라우드 네이티브이므로 가용성이 높다.
- 비용은 RDS에 비해 20% 정도 비싸지만, 스케일링 측면에서 훨씬 더 효율적이다.

### Aurora HA and Read Scaling

- 3개의 AZ를 걸쳐 무엇인가 기록할 때마다 6개의 사본을 저장한다.
    - 6개 사본 중 4개는 쓰기를 위한 것
    - 6개 사본 중 3개는 읽기를 위한 것
    - 자가 복구 과정이 있다.
    - 단일 볼륨에 의존하지 않고, 수 백개의 볼륨을 사용한다.
    - 데이터가 쓰이면, 각기 다른 볼륨에 기록되며 스트라이프 형식으로 되어 있어 매우 잘 작동한다.
    
    ![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/031d5817-26b5-4ea1-b07d-61d00710c5db/Untitled.png)
    
- Aurora는 RDS의 다중 AZ와 유사하다.
- 쓰기를 받는 인스턴스는 1개(마스터)이고, 마스터가 작동하지 않으면 평균 30초 이내로 장애 조치가 시작된다.
    - 마스터 외에 읽기를 제공하는 읽기 전용 복제본을 15개까지 둘 수 있다.
    - 마스터가 문제가 생기면 읽기 전용 복제본 중 하나가 마스터로 대체된다.
- 복제본들은 리전 간 복제를 지원한다.

### Aurora DB Cluster

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/ba0c928f-7e77-41e3-a67f-b41220445752/Untitled.png)

 클라이언트가 수많은 인스턴스와 어떻게 접속할까?

- Aurora는 항상 하나의 마스터만 가지고 있다.
    - Aurora는 writer 엔드포인트를 제공한다.
    - DNS 이름으로 writer 엔드포인트는 항상 마스터를 가리킨다.
    - 따라서 장애 조치 후에도 클라이언트는 writer 엔드포인트와 상호작용하게 된다.
- 많은 읽기 전용 복제본을 가지고 있다.
    - 복제본에 대해 15개까지 자동 스케일을 설정할 수 있다.
    - **리더 엔드포인**트가 있다.
    - 연결 **로드밸런싱 역할**을 한다.
    - 클라이언트가 리더 엔드포인트에 연결하면, 복제본 중 하나로 연결된다.

---

## Aurora Replicas - Auto Scaling

- 리더 엔드포인트에 읽기 요청이 매우 빈번하게 일어나는 경우
- Amazon Aurora 데이터베이스의 CPU 사용량이 증가한다.
- 이런 상황에 복제본 자동 스케일링을 설정하면 된다.
- 이러한 경우, 복제본이 추가되고 새로운 복제본에 대해서 리더 엔드포인트가 연장된다.

### Aurora - Custom Endpoints

- 크기가 다른 두 개의 복제본이 있다.
    - Aurora 인스턴스의 서브셋을 사용자 지정 엔드포인트로 정의하기 위해서이다.
    - 큰 Aurora 인스턴스에 사용자 지정 엔드포인트를 정의한다.
- 사용자 지정 엔드포인트로 정의했다면 리더 엔드포인트는 사용하지 않는다. (사라지지 않지만, 더 이상 사용하지 않게 된다.)

### Aurora Serverless

- **실제 사용량에 기반**한 자동 데이터베이스 인스턴스화와 자동 스케일을 가능하게 해준다.
- **비정기적, 간헐적, 예측 불허한 워크로드에 유용**하다.
- 용량 계획을 세울 필요가 없으며, 각 Aurora 인스턴스에 대해 매 초당 비용을 지불하게 된다. (비용면에서 훨씬 더 효율적이다.)
- 원리
    - 클라이언트는 Aurora 관리 하위 프록시 플릿과 소통한다.
    - 백엔드에서는 **워크로드에 기반해 서버리스 방식으로 여러 Aurora 인스턴스가 생성**된다.
    - **용량을 미리 확보할 필요가 없다.**

### Aurora Multi-Master

- wirter 노드에 대한 즉각적인 장애 조치이다. (writer 노드에 대한 가용성 보장)
- **Aurora 클러스터의 모든 노드에서 읽기 및 쓰기가 가능하다.**
    - 기존에는 하나의 쓰기 노드만 있고, 그 노드에서 장애가 발생하면 읽기 전용 복제본 하나를 새로운 마스터로 승격시켜야 했다.

### Global Aurora

- **Aurora 리전 간 복제본**은 재해 복구에 많은 도움이 되며 간단하게 생성이 가능하다.
- 최근에는 Aurora Global Database를 만드는 것을 권장하고 있다.
    - Global Aurora의 경우 모든 쓰기 및 읽기가 진행되는 하나의 기본 리전이 있다.
    - 복제 지연이 1초 미만인 **보조 읽기 전용 리전을 다섯개까지 설정**할 수 있다.
    - 각 보조 지역마다 읽기 전용 복제본을 16개까지 생성 가능하다.
    - 세계 각지에 있는 읽기 전용 복제본의 **지연 시간을 단축**할 수 있다.
    - 한 리전의 데이터베이스가 작동 중단될 경우, 재해 복구 목적으로 다른 지역을 승격하는데 필요한 **RTO(복구시간 목표)는 1분 미만**이다.
    - Aurora Global 데이터베이스에서 **리전에 걸쳐 데이터를 복제하는데 걸리는 시간은 평균 1초 미만**이다.

### Aurora Machine Learning

- Aurora는 AWS 내의 머신 러닝 서비스와이 통합을 지원한다.
- Aurora 머신 러닝의 개념은 **ML 기반 예측을 SQL 인터페이스로 애플리케이션에 적용**하는 것이다.
- 두 개를 쉽고 최적화된 방식으로 안전하게 통합할 수 있다.
- 지원하는 서비스
    - **Amazon SageMake**r - 백엔드에서 어떤 머신 러닝 모델이라도 사용할 수 있게 해
    - **Amazon Comprehend** - 감정 분석에 사용
- Aurora 머신 러닝을 사용하기 위해 머신러닝 경험은 필요하지 않다.
    - 감지 맞춤 광고, 감정 분석, 제품 추 등으로 활용할 수 있다.
- 아키텍쳐 (동작방식)

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/9f70d3c1-f8b0-4f73-9cde-c24729e26c96/Untitled.png)

---

## RDS & Aurora Backup Monitoring

### RDS Backup

- 자동 백업
    - RDS 서비스가 **자동으로 매일 데이터베이스 유지 관리 시간에 데이터베이스 전체를 백업**한다.
    - 5분마다 트랜잭션 로그도 백업된다. (가장 최신 백업이 5분 전임)
    - 자동 백업을 사용하면 5분 전 어떤 시점으로도 복구가 가능하다.
    - **자동 백업 보유기간은 1일에서 35일까지로 설정**할 수 있다.
        - 기능을 0으로 설정해 자동백업을 **비활성화할 수 있다.**
- 수동 DB 스냅샷 생성
    - 사용자가 수동으로 트리거해야 한다.
    - **원하는 만큼 오랫동안 보유**할 수 있다는 장점이 있다.
        - 자동 백업은 기간이 지나면 사라지지만, 수동으로 만든 DB 스냅샷은 원하는 기간 동안 보유가 가능하다.
- 비용을 절감할 수 있는 방법
    - RDS 데이터베이스가 매달 2시간만 사용할 예정이라면, 2시간 사용 후에 스냅샷을 만들고 원본 데이터베이스를 삭제하는 방법이 있다.
    - 스냅샷의 비용은 RDS 데이터베이스 스토리지보다 훨씬 저렴하다.

### Aurora Backup

- 자동 백업
    - 1일 ~ 35일까지 보유 가능**(비활성화 불가능)**
    - 지정 시간 복구 기능 - 정해진 시간 범위 내의 어느 시점으로 복구가 가능하다.
- 수동 DB 스냅샷 생성
    - 사용자가 수동으로 트리거해야 한다.
    - 원하는 기간 보유가 가능하다.

### RDS & Aurora Restore options

- 복원 가능한 것은 RDS 및 Aurora 백업 또는 스냅샷이다.
- 새로운 데이터베이스에 복원할 수 있다.
- 자동 백업이나 수동 스냅샷을 복원할 때마다 새로운 데이터베이스가 생성된다.

- S3로부터 MySQL RDS 데이터베이스를 복원할 수 있다.
    - S3는 클라우드 객체를 저장하는 서비스
    - 온프레미스 데이터베이스의 백업을 만들어서 객체 스토리지인 Amazon S3에 두는 것이다.
    - RDS에는 Amazon S3에서 MySQL을 실행중인 새로운 RDS 인스턴스로 백업 파일을 복원하는 방법이 있다.

- MySQL Aurora 클러스터로 복구하고 싶으면 온프레미스 데이터베이스를 외부로 다시 백업하고 Percona XtraBackup 소프트웨어를 사용한다.
    - 해당 소프트웨어의 백업 파일이 Amazon S3로 전송된다.
    - 백업 파일을 MySQL을 실행 중인 새 Aurora 클러스터로 복원하면 된다.

RDS MySQL로 복원할 때는 데이터베이스 백업만 있으면 되고, Aurora MySQL로 복원할 때는  Percona XtraBackup 소프트웨어를 사용해서 백업한 다음 3S로부터 Aurora DB 클러스터로 복원하면 된다.

### Aurora Database Cloning

- 데이터베이스로부터 새로운 Aurora DB 클러스터를 만들 수 있다. (복제)
- 스냅샷을 만들고 복원하는 것보다 복제한 Aurora를 사용하는 것이 더 빠르다.
    - 새 데이터베이스는 같은 클러스터 볼륨을 사용하기 때문이다.
- 데이터베이스 복제는 매우 빠르고 비용 측면에서 매우 효율적이다.

---

## RDS Security

- RDS 및 Aurora 데이터베이스에 저장된 데이터를 암호화할 수 있다.
- 데이터가 볼륨에 암호화된다는 의미이다.
- **KMS를 사용해 마스터와 모든 복제본의 암호화**가 이루어지며, 데이터베이스가 처음 실행할 때 정의된다.
- 마스터가 암호화되지 않으면 읽기 전용 복제본 또한 암호화할 수 없다.
- 암호화 되어 있지 않은 기존 데이터베이스를 암호화 하려면 암호화 되지 않은 데이터베이스의 데이터베이스 스냅샷을 가지고 와서 암호화된 데이터베이스 형태로 데이터베이스 스냅샷을 복원해야 한다.
- 저장 암호화 종류
    - **In-flight 암호화** : 클라이언트와 데이터베이스 간의 **전송 중 데이터 암호화**가 있다.
        - RDS 및 Aurora의 각 데이터베이스는 기본 적으로 전송 중 데이터 암호화 기능을 갖추고 있다.
        - 클라이언트는 AWS TLS 루트 인증서를 사용해야 한다.
    - IAM 인증 : 데이터베이스를 접속할 때 사용한다.
    - Security Group : 데이터베이스에 대한 네트워크 액세스를 통제한다.
    - RDS와 Aurora는 SSH 액세스가 없다. (RDS Custom 서비스는 예외)
    - 감사 로그를 통해 시간에 따른 로그 수집을 할 수 있다. (활성화)
        - 해당 로그를 장기 보관을 원한다면, CloudWatch Logs에 전송해야 한다.

---

## RDS Proxy

- VPC 내에 RDS 데이터베이스를 배포할 수 있다.
- 완전 관리형 RDS 데이터베이스를 위한 프록시도 배포할 수 있다.
- 프록시가 필요한 이유
    - Amazon RDS 프록시를 사용하면 애플리케이션이 데이터베이스 내에서 **데이터베이스 연결 풀을 형성하고 공유**할 수 있다.
    - **애플리케이션을 RDS 데이터베이스 인스턴스에 일일이 연결하는 대신 프록시에 연결하면 프록시가 하나의 풀에 연결을 모아 RDS 데이터베이스 인스턴스로 가는 연결이 줄어든다.**
    - CPU나 RAM 등 데이터베이스 리소스의 부담을 줄여, 데이터베이스의 효율성을 향상시킬 수 있다.
    - 데이터베이스에 **개방된 연결과 시간초과를 최소화**할 수 있다.
- 완전 서버리스로, 오토 스케일링이 가능해 용량을 관리할 필요가 없고, 가용성이 높다. (다중 AZ 지원)
- RDS 인스턴스에 장애가 발생하면. 대기 인스턴스로 실행되며 **RDS 프록시 덕에 장애 조치시간을 66% 줄일 수 있다.**
- RDS 프록시는 MySQL. PostgreSQL, MariaDB용 RDS를, MySQL, PostgreSQL Aurora를 지원한다.
- 애플리케이션 코드를 변경하지 않아도 되고, RDS 프록시에 연결하기만 하면 된다.
- 데이터베이스에 IAM 인증을 강제함으로써 **IAM 인증을 통해서만** RDS 데이터베이스 인스턴스에 연결하도록 할 수 있다. (자격증면은 AWS Secrets Manager에 저장된다)
- RDS는 퍼블릭 액세스가 절대 불가능하다.
- **RDS + Lambda 함수 조합 최고!**
    - Lambda는 여러개가 빠르게 생성되고 사라진다.
    - RDS 데이터베이스 인스턴스에 수만 개의 Lambda 함수가 순식간에 발생했다 사라지며 연결을 개방하면 시간 초과 오류 발생한다.
    - 이를 해결하기 위해 Lambda 함수가 RDS 프록시를 오버로드하면 RDS 프록시가 풀을 생성하여 RDS 데이터베이스 인스턴스 연결이 줄어 문제가 해결된다.

---

## ElasticCache

- RDS와 동일한 방식으로 **관계형 데이터베이스를 관리**할 수 있다.
- redis, memcached와 같은 **캐시 기술을 관리**할 수 있도록 한다.
    - 캐시 : 높은 성능과 낮은 지연 시간을 가진 인메모리 데이터베이스이다.
- ElasticCache를 사용하면 **읽기 집약적인 워크로드의 부하를 줄이는데 도움**이 된다.
    - 왜? 일반적인 쿼리가 캐시되기 때문에 데이터베이스에 매번 쿼리되지 않기 때문이다.
- 애플리케이션의 상태를 Amazon ElasticCache에 저장해 애플리케이션을 무상태로 만들 수 있도록 한다.
- RDS와 동일한 방식이기 때문에 AWS가 유지보수를 수행한다.
- ElasticCache를 사용할 때 애플리케이션에 관한 몇 가지 어려운 코드 변경을 요청할 수도 있다.

### Architecture

1. 애플리케이션이 ElasticCache에 쿼리 요청을 보낸다.
    1. 쿼리가 이미 생성되어 저장되어 있는지 확인한다. → 있으면 캐시 Hit → 바로 응답을 얻는다.
2. 만약 캐시 miss라면 데이터베이스에서 데이터를 가져와서 데이터베이스에서 읽는다.
3. 해당 쿼리는 캐시에 기록되어, 동일한 요청이 발생했을 때 바로 응답을 받을 수 있게 된다.

이는 RDS에 부하를 줄이는데 도움이 된다.

데이터를 캐시에 저장하기 때문에 캐시 무효화 전략이 있어야 하며, 가장 최근 데이터만 사용하는지 확인해야 한다.

### Architecture2

- 사용자 세션을 저장해 애플리케이션을 무상태로 만든다.
- 사용자가 로그인하면 애플리케이션이 ElasticCache에 세션 데이터를 기록한다.
- 사용자가 애플리케이션의 다른 인스턴스로 리다이렉션 되면 애플리케이션은 ElasticCache에서 직접 세션 캐시를 검색할 수 있다.

### Redis vs Memcached

- Redis
    - 자동 장애 조치로, 다중 AZ를 수행하는 기술이다.
    - **읽기 전용 복제본**은 읽기 스케일링에 사용되며 **가용성이 높다**.
    - 데이터 내구성이 있다.
    - **백업과 기능 복원 기능**도 있다.
- Memcached
    - **데이터 분할에 다중 노드**를 사용한다. (sharding) → 분산 캐시
    - **가용성이 높지 않고 복제도 발생하지 않는다**.
    - 지속적인 캐시가 아니다.
    - 백업과 복원 기능도 없다.
    - 다중 스레드 아키텍처로 몇몇 샤딩과 함께 캐시에서 함께 실행되는 여러 인스턴스가 있다.

---

## ElasticCache - Cache Security

- ElasticCache의 모든 캐시는 **IAM 인증을 지원하지 않는다**. (캐시 내 모든 작업은)
- IAM 인증은 AWS API 수준 보안에만 사용된다. (캐시 생성 및 삭제 수준에서만)
- Redis AUTH
    - 레디스를 인증하기 위해 사용한다.
    - 레디스 클러스터를 생성할 때 비번이나 토큰을 설정할 수 있다.
    - 이것을 설정하면, 캐시에 들어갈 때 비번 입력이 필요하다.
    - 전송중 암호화를 위해 SSL 보안을 지원할 수 있다.
- Memcached
    - 더 높은 수준인 SASL 기반 인증을 지원한다.

### Patterns for ElasticCache

- 레이지 로딩 : 모든 읽기 데이터가 캐시된다. 데이터가 캐시에서 부실해질 수 있다.
- Write Through : 데이터를 데이터베이스에 기록될 때마다 캐시에 데이터를 추가하거나 업데이트한다.
- Session Store : 세션 저장소(TTL 속성으로 세션 만료)

### ElasticCache - Redis

- 게임 리더보드 생성
- **레디스에는 고유성과 요소 순서를 모두 보장하는 정렬된 집합이라는 기능**이 있다.
- 요소가 추가될 때마다 실시간으로 순위가 매겨진 다음 올바른 순서로 추가된다.
- 레디스 클러스터가 있는 경우 실시간 리더보드를 생성한다.
- 모든 레디스 캐시는 동일한 리더보드를 사용할 수 있다.

클라이언트는 **실시간 리더보드를 액세스**할 수 있기 때문에 이 기능을 애플리케이션 차원에서 프로그래밍할 필요가 없다.
